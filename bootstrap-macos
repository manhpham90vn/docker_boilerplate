#!/bin/bash

source ./common.sh

casks=(
    "google-chrome"
    "android-studio"
    "visual-studio-code"
    "datagrip"
    "sourcetree"
    "iterm2"
    "postman"
    "evkey"
    "xcodes"
    "charles"
    "openvpn-connect"
    "vagrant"
    "docker"
    "virtualbox"
    "google-cloud-sdk"
)

packages=(
    "xcodesorg/made/xcodes"
    "rbenv"
    "nvm"
    "pyenv"
    "goenv"
    "fvm"
    "ruby@3.0"
    "node@20"
    "node@16"
    "python@3.9"
    "go@1.21"
    "postgresql@16"
    "mysql@8.0"
    "redis@7.2"
    "elastic/tap/elasticsearch-full"
    "tree"
    "alembic"
    "awscli"
    "aws-sam-cli"
    "aws-elasticbeanstalk"
    "aws-amplify"
    "eksctl"
    "cloud-sql-proxy"
    "nginx"
    "terraform"
    "terragrunt"
    "ansible"
    "kubectl"
    "helm"
    "minikube"
    "serverless"
)

taps=(
    "hashicorp/tap"
    "leoafarias/fvm"
    "elastic/tap"
)

zshs=(
    "git clone --depth 1 https://github.com/ohmyzsh/ohmyzsh.git \"\$HOME/.oh-my-zsh\""
    "git clone --depth 1 https://github.com/zsh-users/zsh-autosuggestions \${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions"
    "git clone --depth 1 https://github.com/zsh-users/zsh-syntax-highlighting.git \${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting"
)

checkCommand() {
    if ! (type $1 > /dev/null 2>&1); then
        echo "Installing $1"
        return 1
    else
        echo "$1 already installed"
        return 0
    fi
}

checkDirectory() {
    if [ ! -d "$1" ]; then
        echo "Directory $1 does not exist"
        return 1
    else
        echo "Directory $1 already exists"
        return 0
    fi
}

checkFile() {
    if [ ! -f "$1" ]; then
        echo "File $1 does not exist"
        return 1
    else
        echo "File $1 already exists"
        return 0
    fi
}

checkCommand "git" || exit 1
checkCommand "brew" || /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

for tap in ${taps[@]}; do
    brew tap $tap
done

brew install --cask "${casks[@]}"
brew install "${packages[@]}"

checkDirectory "$HOME/.oh-my-zsh" || for ((i = 0; i < ${#zshs[@]}; i++)); do eval "${zshs[$i]}"; done
checkFile "$HOME/.zshrc" || ln -s "$(pwd)/configs/.zshrc-macos" "$HOME/.zshrc"
checkFile "$HOME/.gitconfig" || ln -s "$(pwd)/configs/.gitconfig" "$HOME/.gitconfig"
